# Домашнее задание к занятию " `Микросервисы: подходы` " - `Сулименков Алексей`

Вы работаете в крупной компании, которая строит систему на основе микросервисной архитектуры.
Вам как DevOps-специалисту необходимо выдвинуть предложение по организации инфраструктуры для разработки и эксплуатации.

## Задача 1: Обеспечить разработку

Предложите решение для обеспечения процесса разработки: хранение исходного кода, непрерывная интеграция и непрерывная поставка.
Решение может состоять из одного или нескольких программных продуктов и должно описывать способы и принципы их взаимодействия.

Решение должно соответствовать следующим требованиям:

- облачная система;
- система контроля версий Git;
- репозиторий на каждый сервис;
- запуск сборки по событию из системы контроля версий;
- запуск сборки по кнопке с указанием параметров;
- возможность привязать настройки к каждой сборке;
- возможность создания шаблонов для различных конфигураций сборок;
- возможность безопасного хранения секретных данных (пароли, ключи доступа);
- несколько конфигураций для сборки из одного репозитория;
- кастомные шаги при сборке;
- собственные докер-образы для сборки проектов;
- возможность развернуть агентов сборки на собственных серверах;
- возможность параллельного запуска нескольких сборок;
- возможность параллельного запуска тестов.

Обоснуйте свой выбор.

---

### Ответ

Для обеспечения процесса разработки предлагаю использовать следующие програмные продукты:

- **GitHub/GitLab**
- Хранение исходного кода
- Управление репозиториями
- Issue tracking
- Code review

- **GitLab CI/CD**
- Конфигурация через `.gitlab-ci.yml`
- Управление пайплайнами
- Хранение секретов
- Управление агентами сборки

- **Docker**
- Создание изолированных окружений
- Повторное использование образов
- Детерминированные сборки

- **Kubernetes**
- Масштабирование агентов
- Управление ресурсами
- Балансировка нагрузки

- **Keycloak**
- Централизованная аутентификация
- Управление пользователями
- OAuth2/OIDC поддержка
- Single Sign-On (SSO)

                        +---------------------+
                        |    GitHub/GitLab    |
                        |    (репозитории)    |
                        +----------+---------+
                                   ||
                                   ||
                        +----------+----------+
                        |   GitLab CI/CD      |
                        |  (конфигурация)     |
                        +----------+----------+
                                   ||
                        +----------+----------+
                        |  Docker Registry    |
                        |  (хранение образов) |
                        +----------+----------+
                                   ||
                        +----------+----------+
                        |   Kubernetes        |
                        |   (оркестрация)     |
                        +---------------------+
                                   ||
                        +---------------------+
                        |     Keycloak        |
                        |  (аутентификация)   |
                        +---------------------+

---

## Задача 2: Логи

Предложите решение для обеспечения сбора и анализа логов сервисов в микросервисной архитектуре.
Решение может состоять из одного или нескольких программных продуктов и должно описывать способы и принципы их взаимодействия.

Решение должно соответствовать следующим требованиям:

- сбор логов в центральное хранилище со всех хостов, обслуживающих систему;
- минимальные требования к приложениям, сбор логов из stdout;
- гарантированная доставка логов до центрального хранилища;
- обеспечение поиска и фильтрации по записям логов;
- обеспечение пользовательского интерфейса с возможностью предоставления доступа разработчикам для поиска по записям логов;
- возможность дать ссылку на сохранённый поиск по записям логов.

Обоснуйте свой выбор.

---

### Ответ

1. **Приложения**

- Вывод логов через stdout/stderr

2. **Logstash/Filebeat**

- Агенты сбора логов
- Сбор данных с приложений
- Предварительная обработка
- Отправка в очередь

3. **Redis/Kafka**

- Буферизация данных
- Гарантированная доставка
- Отказоустойчивость
- Балансировка нагрузки

4. **Loki**

- Специализированное хранилище логов
- Эффективное сжатие текстовых данных
- Быстрый поиск по меткам
- Горизонтальное масштабирование

5. **Grafana**

- Визуализация данных
- Построение дашбордов
- Анализ логов через интерфейс
- Сохранение поисковых запросов

6. **Nginx/Auth**

- Прокси-сервер
- Аутентификация пользователей
- Управление доступом
- Защита данных

### Особенности Loki

- **Оптимизирован** для работы с логами
- **Эффективное хранение** текстовых данных
- **Простой синтаксис** запросов
- **Интеграция** с Prometheus
- **Масштабируемая архитектура**

### Потоки данных

- **Основной поток**: Приложения → Агенты сбора → Очередь → Loki
- **Визуализация**: Loki → Grafana
- **Доступ пользователей**: Пользователи → Nginx/Auth → Grafana

---

## Задача 3: Мониторинг

Предложите решение для обеспечения сбора и анализа состояния хостов и сервисов в микросервисной архитектуре.
Решение может состоять из одного или нескольких программных продуктов и должно описывать способы и принципы их взаимодействия.

Решение должно соответствовать следующим требованиям:

- сбор метрик со всех хостов, обслуживающих систему;
- сбор метрик состояния ресурсов хостов: CPU, RAM, HDD, Network;
- сбор метрик потребляемых ресурсов для каждого сервиса: CPU, RAM, HDD, Network;
- сбор метрик, специфичных для каждого сервиса;
- пользовательский интерфейс с возможностью делать запросы и агрегировать информацию;
- пользовательский интерфейс с возможностью настраивать различные панели для отслеживания состояния системы.

Обоснуйте свой выбор.

---

### Ответ

- **Exporters**

  - **Node Exporter** — метрики хоста
  - **Pushgateway** — кастомные метрики
  - **Blackbox Exporter** — мониторинг доступности
  - **Сервис-специфичные экспортеры**

- **VictoriaMetrics**

  - **Преимущества перед Prometheus:**
    - Более эффективное использование ресурсов
    - Масштабируемое хранилище
    - Высокая производительность записи
    - Эффективное сжатие данных
    - Сбор и хранение метрик
    - Система запросов
    - Автоматическое обнаружение

- **Grafana**

  - Визуализация данных
  - Создание дашбордов
  - Алерты и уведомления
  - Пользовательский интерфейс

- **Alertmanager**

  - Управление оповещениями
  - Группировка алертов
  - Отправка уведомлений

- **Nginx/Auth**
  - Прокси-сервер
  - Аутентификация
  - Управление доступом

---
